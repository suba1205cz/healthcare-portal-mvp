generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---- ROLES & STATUSES ----

enum Role {
  PATIENT          // normal user / patient
  PROFESSIONAL     // nurse / physiotherapist
  ADMIN            // platform admin (we'll use later)
  PROVIDER_ADMIN   // organisation/vendor admin (later)
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// ---- USER ----

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      Role      @default(PATIENT)
  createdAt DateTime  @default(now())

  profiles  Profile[]
  bookings  Booking[] @relation("PatientBookings")
  ratings   Rating[]
}

// ---- PROVIDER PROFILE ----

model Profile {
  id              Int          @id @default(autoincrement())
  userId          Int
  user            User         @relation(fields: [userId], references: [id])

  specialties     String       // text like "Home nursing, post-op care"
  location        String       // text like "Kochi, Kerala"
  bio             String?
  hourlyRate      Int?         // optional, e.g. 500 (₹ or your currency)
  experienceYears Int?         // e.g. 8
  languages       String?      // "English, Malayalam"
  verified        Boolean      @default(false)
  createdAt       DateTime     @default(now())

  availabilities  Availability[]
  bookings        Booking[]    @relation("ProfessionalBookings")
  ratings         Rating[]
}

// ---- PROVIDER AVAILABILITY ----

model Availability {
  id        Int      @id @default(autoincrement())
  profileId Int
  profile   Profile  @relation(fields: [profileId], references: [id])
  start     DateTime
  end       DateTime?
  createdAt DateTime @default(now())
}

// ---- BOOKING / APPOINTMENT ----

model Booking {
  id              Int            @id @default(autoincrement())
  patientId       Int
  professionalId  Int
  patient         User           @relation("PatientBookings", fields: [patientId], references: [id])
  professional    Profile        @relation("ProfessionalBookings", fields: [professionalId], references: [id])

  start           DateTime
  end             DateTime
  address         String?
  notes           String?
  createdAt       DateTime       @default(now())
  status          BookingStatus  @default(PENDING)

  rating          Rating?
}

// ---- RATING / REVIEW ----

model Rating {
  id            Int       @id @default(autoincrement())
  appointmentId Int       @unique
  patientId     Int
  providerId    Int
  score         Int       // 1–5
  comment       String?
  createdAt     DateTime  @default(now())

  appointment   Booking   @relation(fields: [appointmentId], references: [id])
  patient       User      @relation(fields: [patientId], references: [id])
  provider      Profile   @relation(fields: [providerId], references: [id])
}
